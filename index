<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bank Analyzer - NLB Statement Dashboard</title>
  <meta name="description" content="Analyze your NLB bank statements with beautiful charts and insights">
  <meta name="theme-color" content="#0f172a">
  <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Bank Analyzer&quot;,&quot;short_name&quot;:&quot;BankApp&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;%230f172a&quot;,&quot;theme_color&quot;:&quot;%230f172a&quot;}">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, sans-serif; }
    body { background: #0f172a; color: #f8fafc; min-height: 100vh; }
    .mono { font-family: 'IBM Plex Mono', monospace; }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #1e293b; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    
    /* Loading spinner */
    .spinner { 
      width: 40px; height: 40px; 
      border: 3px solid #334155; 
      border-top-color: #22d3ee; 
      border-radius: 50%; 
      animation: spin 1s linear infinite; 
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* Mobile optimizations */
    @media (max-width: 768px) {
      .hide-mobile { display: none !important; }
      .mobile-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    }
    
    /* PWA install prompt */
    .install-prompt {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: linear-gradient(135deg, #0ea5e9 0%, #22d3ee 100%);
      color: #0f172a; padding: 12px 24px; border-radius: 50px;
      font-weight: 600; cursor: pointer; z-index: 1000;
      box-shadow: 0 10px 40px rgba(34, 211, 238, 0.3);
      display: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <div class="install-prompt" id="installPrompt" onclick="installApp()">ðŸ“± Install App</div>

  <script>
    // PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    
    // PWA Install
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installPrompt').style.display = 'block';
    });
    
    function installApp() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(() => {
          document.getElementById('installPrompt').style.display = 'none';
          deferredPrompt = null;
        });
      }
    }
  </script>

  <script type="text/babel">
    const { useState, useCallback, useEffect } = React;
    const { PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, LineChart, Line, CartesianGrid, AreaChart, Area } = Recharts;

    // Icons as simple SVG components
    const Icons = {
      Upload: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
      TrendingUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      TrendingDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>,
      CreditCard: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>,
      ShoppingBag: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>,
      Car: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 16H9m10 0h3v-3.15a1 1 0 0 0-.84-.99L16 11l-2.7-3.6a1 1 0 0 0-.8-.4H5.24a2 2 0 0 0-1.8 1.1l-.8 1.63A6 6 0 0 0 2 12.42V16h2"/><circle cx="6.5" cy="16.5" r="2.5"/><circle cx="16.5" cy="16.5" r="2.5"/></svg>,
      Utensils: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>,
      Home: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
      Plane: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"/></svg>,
      Coffee: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" y1="2" x2="6" y2="4"/><line x1="10" y1="2" x2="10" y2="4"/><line x1="14" y1="2" x2="14" y2="4"/></svg>,
      Fuel: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="22" x2="15" y2="22"/><line x1="4" y1="9" x2="14" y2="9"/><path d="M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18"/><path d="M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5"/></svg>,
      ShoppingCart: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>,
      DollarSign: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      ArrowUpRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/></svg>,
      ArrowDownRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="7" y1="7" x2="17" y2="17"/><polyline points="17 7 17 17 7 17"/></svg>,
      FileText: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
      X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ChevronDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"/></svg>,
      ChevronUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="18 15 12 9 6 15"/></svg>,
      Trash2: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
      Menu: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>,
      Download: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
    };

    // Category configuration
    const CATEGORY_RULES = {
      'Groceries': ['LIDL', 'HOFER', 'SPAR', 'INTERSPAR', 'MERCATOR', 'SUPERMARKET', 'TUÅ ', 'EUROSPIN'],
      'Fuel': ['MOL', 'PETROL', 'OMV', 'ESSO', 'Shell', 'AVANTI'],
      'Restaurants & Bars': ['MCDONALDS', 'PUB', 'BAR', 'RESTAVRACIJA', 'PIVNICA', 'HOLIDAYS', 'CUTTY SARK', 'HORSES', 'AVIO BAR', 'NEBO', 'GOSTILNA', 'PIZZERIA'],
      'Travel': ['ASFINAG', 'DARS', 'EVINJETA', 'BOOKING', 'HOTEL', 'TERME', 'AVTOCAMP', 'Railways', 'AUTOBAHNREST', 'AIRBNB', 'HOSTEL'],
      'Shopping': ['ZARA', 'AMAZON', 'AMZN', 'ALDI', 'H&M', 'MANGO', 'ABOUTYOU', 'ZALANDO'],
      'Entertainment': ['BOLDER SCENA', 'OLAII', 'VSTOPNICE', 'KINO', 'CINEMA', 'NETFLIX', 'SPOTIFY'],
      'Transportation': ['CAR PAYMENT', 'AUTOHAUS', 'TEHNICNI PREGLEDI', 'ZAVAROVALNICA', 'AMZS'],
      'Transfers': ['REVOLUT', 'QUASI CASH', 'WISE', 'PAYPAL'],
      'Personal': ['hrana', 'karta za let', 'boat', 'Lizika', 'PICA'],
      'Services': ['POSTA', 'PROVIZIJA', 'TELEKOM', 'A1', 'TELEMACH'],
      'Income': ['ADRIAL', 'REDNO DELO', 'PLAÄŒA', 'HONORAR', 'POVRAÄŒILO']
    };

    const CATEGORY_COLORS = {
      'Groceries': '#10B981',
      'Fuel': '#F59E0B',
      'Restaurants & Bars': '#EC4899',
      'Travel': '#3B82F6',
      'Shopping': '#8B5CF6',
      'Entertainment': '#06B6D4',
      'Transportation': '#EF4444',
      'Transfers': '#6366F1',
      'Personal': '#14B8A6',
      'Services': '#64748B',
      'Income': '#22C55E',
      'Other': '#94A3B8'
    };

    const CATEGORY_ICONS = {
      'Groceries': Icons.ShoppingCart,
      'Fuel': Icons.Fuel,
      'Restaurants & Bars': Icons.Coffee,
      'Travel': Icons.Plane,
      'Shopping': Icons.ShoppingBag,
      'Entertainment': Icons.CreditCard,
      'Transportation': Icons.Car,
      'Transfers': Icons.DollarSign,
      'Personal': Icons.Home,
      'Services': Icons.FileText,
      'Income': Icons.TrendingUp,
      'Other': Icons.CreditCard
    };

    function categorizeTransaction(description) {
      const upperDesc = description.toUpperCase();
      for (const [category, keywords] of Object.entries(CATEGORY_RULES)) {
        if (keywords.some(keyword => upperDesc.includes(keyword.toUpperCase()))) {
          return category;
        }
      }
      return 'Other';
    }

    // Parse NLB PDF text
    function parseNLBStatement(text) {
      const transactions = [];
      const lines = text.split('\n');
      
      // Multiple patterns for NLB statement formats
      const patterns = [
        /^(\d{2}\.\d{2}\.\d{2})\s+(.+?)\s+([+-]?\d{1,3}(?:[.,]\d{3})*[.,]\d{2})\s+(\d{1,3}(?:[.,]\d{3})*[.,]\d{2})$/,
        /^(\d{2}\.\d{2}\.\d{2})\s+(.+?)\s+(-?\d+[.,]\d{2})\s+(\d+[.,]\d{2})$/,
        /^(\d{2}\.\d{2}\.\d{2})\s+(.+?)\s+([+-]?\d+[.,]\d{2})$/
      ];

      let lastBalance = 0;

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        
        if (!line || 
            line.includes('STANJE PREDHODNEGA') || 
            line.includes('SKUPNI PROMET') || 
            line.includes('NOVO STANJE') || 
            line.includes('Datum') ||
            line.includes('LETNA OBRESTNA') ||
            line.includes('EUR - EVRO') ||
            line.includes('NLB PAKET') ||
            line.includes('Obvestilo') ||
            line.includes('Varnostna koda')) {
          continue;
        }

        for (const pattern of patterns) {
          const match = line.match(pattern);
          if (match) {
            const [, date, description, amountStr, balanceStr] = match;
            
            // Parse amount
            let amount = parseFloat(amountStr.replace(/\./g, '').replace(',', '.'));
            const balance = balanceStr ? parseFloat(balanceStr.replace(/\./g, '').replace(',', '.')) : lastBalance + amount;
            
            // Determine if income or expense
            const isPositive = amountStr.startsWith('+');
            const isNegative = amountStr.startsWith('-');
            
            if (!isPositive && !isNegative) {
              // Check if it's income based on keywords
              const incomeKeywords = ['ADRIAL', 'REDNO DELO', 'PLAÄŒA', 'HONORAR', 'POVRAÄŒILO'];
              const isIncome = incomeKeywords.some(k => description.toUpperCase().includes(k));
              if (!isIncome) {
                amount = -Math.abs(amount);
              }
            }

            const category = categorizeTransaction(description);
            lastBalance = balance;

            transactions.push({
              id: `${date}-${i}-${Math.random().toString(36).substr(2, 9)}`,
              date,
              description: description.trim(),
              amount,
              balance,
              category,
              isIncome: amount > 0
            });
            break;
          }
        }
      }

      return transactions;
    }

    // Extract text from PDF using PDF.js
    async function extractTextFromPDF(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = async (e) => {
          try {
            const typedArray = new Uint8Array(e.target.result);
            const pdf = await pdfjsLib.getDocument(typedArray).promise;
            let fullText = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
              const page = await pdf.getPage(i);
              const textContent = await page.getTextContent();
              const pageText = textContent.items.map(item => item.str).join(' ');
              fullText += pageText + '\n';
            }
            
            resolve(fullText);
          } catch (error) {
            reject(error);
          }
        };
        reader.onerror = reject;
        reader.readAsArrayBuffer(file);
      });
    }

    // Format currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat('de-DE', { 
        style: 'currency', 
        currency: 'EUR',
        minimumFractionDigits: 2 
      }).format(amount);
    }

    // Main App Component
    function BankAnalyzer() {
      const [transactions, setTransactions] = useState([]);
      const [isDragging, setIsDragging] = useState(false);
      const [uploadedFiles, setUploadedFiles] = useState([]);
      const [selectedCategory, setSelectedCategory] = useState(null);
      const [showAllTransactions, setShowAllTransactions] = useState(false);
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState(null);
      const [activeTab, setActiveTab] = useState('overview');

      // Load from localStorage on mount
      useEffect(() => {
        const saved = localStorage.getItem('bankAnalyzerData');
        if (saved) {
          try {
            const data = JSON.parse(saved);
            setTransactions(data.transactions || []);
            setUploadedFiles(data.files || []);
          } catch (e) {
            console.error('Failed to load saved data:', e);
          }
        }
      }, []);

      // Save to localStorage when data changes
      useEffect(() => {
        if (transactions.length > 0 || uploadedFiles.length > 0) {
          localStorage.setItem('bankAnalyzerData', JSON.stringify({
            transactions,
            files: uploadedFiles
          }));
        }
      }, [transactions, uploadedFiles]);

      // Calculate statistics
      const totalIncome = transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
      const totalExpenses = Math.abs(transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0));
      const netBalance = totalIncome - totalExpenses;

      // Group by category for expenses
      const categoryTotals = transactions.reduce((acc, t) => {
        if (t.amount < 0) {
          const category = t.category;
          acc[category] = (acc[category] || 0) + Math.abs(t.amount);
        }
        return acc;
      }, {});

      const pieData = Object.entries(categoryTotals)
        .map(([name, value]) => ({ name, value: parseFloat(value.toFixed(2)) }))
        .sort((a, b) => b.value - a.value);

      // Daily balance for chart
      const dailyBalance = transactions.reduce((acc, t) => {
        const existing = acc.find(d => d.date === t.date);
        if (existing) {
          existing.balance = t.balance;
          existing.spending = (existing.spending || 0) + (t.amount < 0 ? Math.abs(t.amount) : 0);
        } else {
          acc.push({ 
            date: t.date, 
            balance: t.balance,
            spending: t.amount < 0 ? Math.abs(t.amount) : 0
          });
        }
        return acc;
      }, []);

      // Income sources
      const incomeSources = transactions
        .filter(t => t.amount > 0)
        .reduce((acc, t) => {
          const source = t.description.split(' ')[0];
          acc[source] = (acc[source] || 0) + t.amount;
          return acc;
        }, {});

      const incomeData = Object.entries(incomeSources)
        .map(([name, value]) => ({ name, value: parseFloat(value.toFixed(2)) }))
        .sort((a, b) => b.value - a.value);

      // Handle file upload
      const handleFiles = useCallback(async (files) => {
        const pdfFiles = Array.from(files).filter(f => f.type === 'application/pdf' || f.name.endsWith('.pdf'));
        
        if (pdfFiles.length === 0) {
          setError('Please upload PDF files only');
          return;
        }

        setIsLoading(true);
        setError(null);

        try {
          let allTransactions = [...transactions];
          const newFileNames = [];

          for (const file of pdfFiles) {
            if (uploadedFiles.includes(file.name)) {
              continue; // Skip already uploaded files
            }
            
            const text = await extractTextFromPDF(file);
            const parsed = parseNLBStatement(text);
            
            if (parsed.length === 0) {
              console.warn(`No transactions found in ${file.name}`);
            }
            
            allTransactions = [...allTransactions, ...parsed];
            newFileNames.push(file.name);
          }

          // Sort by date
          allTransactions.sort((a, b) => {
            const [dayA, monthA, yearA] = a.date.split('.');
            const [dayB, monthB, yearB] = b.date.split('.');
            const dateA = new Date(2000 + parseInt(yearA), parseInt(monthA) - 1, parseInt(dayA));
            const dateB = new Date(2000 + parseInt(yearB), parseInt(monthB) - 1, parseInt(dayB));
            return dateA - dateB;
          });

          // Remove duplicates based on date + description + amount
          const seen = new Set();
          allTransactions = allTransactions.filter(t => {
            const key = `${t.date}-${t.description}-${t.amount}`;
            if (seen.has(key)) return false;
            seen.add(key);
            return true;
          });

          setTransactions(allTransactions);
          setUploadedFiles(prev => [...prev, ...newFileNames]);
        } catch (err) {
          console.error('Error processing PDF:', err);
          setError('Error processing PDF file. Please make sure it\'s a valid NLB bank statement.');
        } finally {
          setIsLoading(false);
        }
      }, [transactions, uploadedFiles]);

      const handleDrop = useCallback((e) => {
        e.preventDefault();
        setIsDragging(false);
        handleFiles(e.dataTransfer?.files || e.target?.files);
      }, [handleFiles]);

      const handleDragOver = useCallback((e) => {
        e.preventDefault();
        setIsDragging(true);
      }, []);

      const handleDragLeave = useCallback((e) => {
        e.preventDefault();
        setIsDragging(false);
      }, []);

      const clearAllData = () => {
        if (confirm('Are you sure you want to clear all data?')) {
          setTransactions([]);
          setUploadedFiles([]);
          localStorage.removeItem('bankAnalyzerData');
        }
      };

      const exportData = () => {
        const data = {
          transactions,
          summary: {
            totalIncome,
            totalExpenses,
            netBalance,
            categoryTotals
          },
          exportedAt: new Date().toISOString()
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `bank-analysis-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
      };

      const filteredTransactions = selectedCategory 
        ? transactions.filter(t => t.category === selectedCategory)
        : transactions;

      const displayedTransactions = showAllTransactions 
        ? filteredTransactions 
        : filteredTransactions.slice(-15).reverse();

      return (
        <div style={{ minHeight: '100vh', background: '#0f172a' }}>
          {/* Header */}
          <header style={{ 
            borderBottom: '1px solid #1e293b', 
            background: 'rgba(15, 23, 42, 0.8)', 
            backdropFilter: 'blur(20px)',
            position: 'sticky',
            top: 0,
            zIndex: 50
          }}>
            <div style={{ maxWidth: '1280px', margin: '0 auto', padding: '16px 24px', display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '16px' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                <div style={{ 
                  width: '44px', 
                  height: '44px', 
                  borderRadius: '12px', 
                  background: 'linear-gradient(135deg, #34d399 0%, #22d3ee 100%)', 
                  display: 'flex', 
                  alignItems: 'center', 
                  justifyContent: 'center' 
                }}>
                  <div style={{ color: '#0f172a', width: '22px', height: '22px' }}><Icons.CreditCard /></div>
                </div>
                <div>
                  <h1 style={{ fontSize: '20px', fontWeight: 600, letterSpacing: '-0.025em', margin: 0 }}>Bank Analyzer</h1>
                  <p style={{ fontSize: '12px', color: '#64748b', margin: 0 }}>NLB Statement Dashboard</p>
                </div>
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '16px', flexWrap: 'wrap' }}>
                {transactions.length > 0 && (
                  <>
                    <span style={{ fontSize: '14px', color: '#94a3b8' }}>{transactions.length} transactions</span>
                    <button 
                      onClick={exportData}
                      style={{ 
                        padding: '8px 16px', 
                        background: '#1e293b', 
                        border: '1px solid #334155', 
                        borderRadius: '8px', 
                        color: '#e2e8f0', 
                        cursor: 'pointer',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        fontSize: '14px'
                      }}
                    >
                      <div style={{ width: '16px', height: '16px' }}><Icons.Download /></div>
                      Export
                    </button>
                    <button 
                      onClick={clearAllData}
                      style={{ 
                        padding: '8px 16px', 
                        background: 'rgba(239, 68, 68, 0.1)', 
                        border: '1px solid rgba(239, 68, 68, 0.3)', 
                        borderRadius: '8px', 
                        color: '#f87171', 
                        cursor: 'pointer',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        fontSize: '14px'
                      }}
                    >
                      <div style={{ width: '16px', height: '16px' }}><Icons.Trash2 /></div>
                      Clear
                    </button>
                  </>
                )}
              </div>
            </div>
          </header>

          <main style={{ maxWidth: '1280px', margin: '0 auto', padding: '32px 24px' }}>
            {/* Upload Zone */}
            <div
              style={{
                marginBottom: '32px',
                borderRadius: '20px',
                border: `2px dashed ${isDragging ? '#34d399' : '#334155'}`,
                background: isDragging ? 'rgba(52, 211, 153, 0.1)' : 'rgba(30, 41, 59, 0.3)',
                transition: 'all 0.3s ease'
              }}
              onDrop={handleDrop}
              onDragOver={handleDragOver}
              onDragLeave={handleDragLeave}
            >
              <label style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', padding: '48px 24px', cursor: 'pointer' }}>
                <input
                  type="file"
                  accept=".pdf"
                  multiple
                  style={{ display: 'none' }}
                  onChange={(e) => handleFiles(e.target.files)}
                />
                {isLoading ? (
                  <div className="spinner" style={{ marginBottom: '16px' }}></div>
                ) : (
                  <div style={{ width: '48px', height: '48px', marginBottom: '16px', color: isDragging ? '#34d399' : '#64748b' }}>
                    <Icons.Upload />
                  </div>
                )}
                <p style={{ fontSize: '18px', fontWeight: 500, marginBottom: '4px' }}>
                  {isLoading ? 'Processing...' : 'Drop your NLB bank statements here'}
                </p>
                <p style={{ fontSize: '14px', color: '#64748b' }}>or click to browse â€¢ PDF files only</p>
                
                {error && (
                  <p style={{ marginTop: '16px', color: '#f87171', fontSize: '14px' }}>{error}</p>
                )}
                
                {uploadedFiles.length > 0 && (
                  <div style={{ marginTop: '16px', display: 'flex', flexWrap: 'wrap', gap: '8px', justifyContent: 'center' }}>
                    {uploadedFiles.map((file, i) => (
                      <span key={i} style={{ 
                        padding: '6px 12px', 
                        borderRadius: '50px', 
                        background: 'rgba(52, 211, 153, 0.2)', 
                        color: '#34d399', 
                        fontSize: '13px',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px'
                      }}>
                        <div style={{ width: '14px', height: '14px' }}><Icons.FileText /></div>
                        {file}
                      </span>
                    ))}
                  </div>
                )}
              </label>
            </div>

            {transactions.length === 0 ? (
              <div style={{ textAlign: 'center', padding: '80px 24px' }}>
                <div style={{ width: '80px', height: '80px', margin: '0 auto 24px', color: '#334155' }}>
                  <Icons.FileText />
                </div>
                <h2 style={{ fontSize: '24px', fontWeight: 600, marginBottom: '8px' }}>No transactions yet</h2>
                <p style={{ color: '#64748b', maxWidth: '400px', margin: '0 auto' }}>
                  Upload your NLB bank statement PDFs to see your spending analysis and insights
                </p>
              </div>
            ) : (
              <>
                {/* Summary Cards */}
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '16px', marginBottom: '32px' }}>
                  <div style={{ 
                    background: 'linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.05) 100%)', 
                    borderRadius: '20px', 
                    padding: '24px',
                    border: '1px solid rgba(16, 185, 129, 0.2)'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '16px' }}>
                      <div style={{ width: '44px', height: '44px', borderRadius: '12px', background: 'rgba(16, 185, 129, 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <div style={{ color: '#34d399', width: '22px', height: '22px' }}><Icons.ArrowUpRight /></div>
                      </div>
                      <span style={{ color: '#94a3b8', fontSize: '14px', fontWeight: 500 }}>Total Income</span>
                    </div>
                    <p className="mono" style={{ fontSize: '28px', fontWeight: 700, color: '#34d399' }}>
                      {formatCurrency(totalIncome)}
                    </p>
                  </div>

                  <div style={{ 
                    background: 'linear-gradient(135deg, rgba(244, 63, 94, 0.15) 0%, rgba(244, 63, 94, 0.05) 100%)', 
                    borderRadius: '20px', 
                    padding: '24px',
                    border: '1px solid rgba(244, 63, 94, 0.2)'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '16px' }}>
                      <div style={{ width: '44px', height: '44px', borderRadius: '12px', background: 'rgba(244, 63, 94, 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <div style={{ color: '#fb7185', width: '22px', height: '22px' }}><Icons.ArrowDownRight /></div>
                      </div>
                      <span style={{ color: '#94a3b8', fontSize: '14px', fontWeight: 500 }}>Total Expenses</span>
                    </div>
                    <p className="mono" style={{ fontSize: '28px', fontWeight: 700, color: '#fb7185' }}>
                      {formatCurrency(totalExpenses)}
                    </p>
                  </div>

                  <div style={{ 
                    background: `linear-gradient(135deg, rgba(${netBalance >= 0 ? '34, 211, 238' : '251, 191, 36'}, 0.15) 0%, rgba(${netBalance >= 0 ? '34, 211, 238' : '251, 191, 36'}, 0.05) 100%)`, 
                    borderRadius: '20px', 
                    padding: '24px',
                    border: `1px solid rgba(${netBalance >= 0 ? '34, 211, 238' : '251, 191, 36'}, 0.2)`
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '16px' }}>
                      <div style={{ width: '44px', height: '44px', borderRadius: '12px', background: `rgba(${netBalance >= 0 ? '34, 211, 238' : '251, 191, 36'}, 0.2)`, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <div style={{ color: netBalance >= 0 ? '#22d3ee' : '#fbbf24', width: '22px', height: '22px' }}><Icons.DollarSign /></div>
                      </div>
                      <span style={{ color: '#94a3b8', fontSize: '14px', fontWeight: 500 }}>Net Balance</span>
                    </div>
                    <p className="mono" style={{ fontSize: '28px', fontWeight: 700, color: netBalance >= 0 ? '#22d3ee' : '#fbbf24' }}>
                      {netBalance >= 0 ? '+' : ''}{formatCurrency(netBalance)}
                    </p>
                  </div>
                </div>

                {/* Charts */}
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(350px, 1fr))', gap: '24px', marginBottom: '32px' }}>
                  {/* Spending by Category */}
                  <div style={{ background: 'rgba(30, 41, 59, 0.5)', borderRadius: '20px', padding: '24px', border: '1px solid #334155' }}>
                    <h2 style={{ fontSize: '18px', fontWeight: 600, marginBottom: '24px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <div style={{ width: '20px', height: '20px', color: '#64748b' }}><Icons.ShoppingBag /></div>
                      Spending by Category
                    </h2>
                    <div style={{ height: '280px' }}>
                      <ResponsiveContainer width="100%" height="100%">
                        <PieChart>
                          <Pie
                            data={pieData}
                            cx="50%"
                            cy="50%"
                            innerRadius={55}
                            outerRadius={95}
                            paddingAngle={2}
                            dataKey="value"
                            onClick={(data) => setSelectedCategory(selectedCategory === data.name ? null : data.name)}
                            style={{ cursor: 'pointer' }}
                          >
                            {pieData.map((entry, index) => (
                              <Cell 
                                key={`cell-${index}`} 
                                fill={CATEGORY_COLORS[entry.name] || '#94A3B8'}
                                opacity={selectedCategory && selectedCategory !== entry.name ? 0.3 : 1}
                                stroke={selectedCategory === entry.name ? '#fff' : 'transparent'}
                                strokeWidth={2}
                              />
                            ))}
                          </Pie>
                          <Tooltip
                            content={({ active, payload }) => {
                              if (active && payload && payload.length) {
                                const data = payload[0].payload;
                                return (
                                  <div style={{ background: '#1e293b', border: '1px solid #334155', borderRadius: '8px', padding: '8px 12px' }}>
                                    <p style={{ fontWeight: 500 }}>{data.name}</p>
                                    <p style={{ fontSize: '14px', color: '#94a3b8' }}>{formatCurrency(data.value)}</p>
                                  </div>
                                );
                              }
                              return null;
                            }}
                          />
                        </PieChart>
                      </ResponsiveContainer>
                    </div>
                    <div style={{ marginTop: '16px', display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '8px' }}>
                      {pieData.slice(0, 6).map((cat) => {
                        const Icon = CATEGORY_ICONS[cat.name] || Icons.CreditCard;
                        return (
                          <button
                            key={cat.name}
                            onClick={() => setSelectedCategory(selectedCategory === cat.name ? null : cat.name)}
                            style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '8px',
                              padding: '8px 12px',
                              borderRadius: '8px',
                              background: selectedCategory === cat.name ? '#334155' : 'rgba(51, 65, 85, 0.3)',
                              border: selectedCategory === cat.name ? '1px solid rgba(255,255,255,0.2)' : '1px solid transparent',
                              color: '#e2e8f0',
                              cursor: 'pointer',
                              textAlign: 'left'
                            }}
                          >
                            <div style={{ width: '10px', height: '10px', borderRadius: '50%', background: CATEGORY_COLORS[cat.name], flexShrink: 0 }} />
                            <span style={{ fontSize: '12px', flex: 1, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{cat.name}</span>
                            <span style={{ fontSize: '12px', color: '#64748b' }}>â‚¬{cat.value.toFixed(0)}</span>
                          </button>
                        );
                      })}
                    </div>
                  </div>

                  {/* Balance Over Time */}
                  <div style={{ background: 'rgba(30, 41, 59, 0.5)', borderRadius: '20px', padding: '24px', border: '1px solid #334155' }}>
                    <h2 style={{ fontSize: '18px', fontWeight: 600, marginBottom: '24px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <div style={{ width: '20px', height: '20px', color: '#64748b' }}><Icons.TrendingDown /></div>
                      Balance Over Time
                    </h2>
                    <div style={{ height: '320px' }}>
                      <ResponsiveContainer width="100%" height="100%">
                        <AreaChart data={dailyBalance}>
                          <defs>
                            <linearGradient id="balanceGradient" x1="0" y1="0" x2="0" y2="1">
                              <stop offset="5%" stopColor="#22d3ee" stopOpacity={0.3}/>
                              <stop offset="95%" stopColor="#22d3ee" stopOpacity={0}/>
                            </linearGradient>
                          </defs>
                          <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                          <XAxis dataKey="date" stroke="#64748b" fontSize={11} tickLine={false} />
                          <YAxis stroke="#64748b" fontSize={11} tickLine={false} tickFormatter={(v) => `â‚¬${(v/1000).toFixed(0)}k`} />
                          <Tooltip
                            content={({ active, payload, label }) => {
                              if (active && payload && payload.length) {
                                return (
                                  <div style={{ background: '#1e293b', border: '1px solid #334155', borderRadius: '8px', padding: '8px 12px' }}>
                                    <p style={{ fontSize: '12px', color: '#94a3b8' }}>{label}</p>
                                    <p style={{ fontWeight: 500 }}>{formatCurrency(payload[0].value)}</p>
                                  </div>
                                );
                              }
                              return null;
                            }}
                          />
                          <Area type="monotone" dataKey="balance" stroke="#22d3ee" strokeWidth={2} fill="url(#balanceGradient)" />
                        </AreaChart>
                      </ResponsiveContainer>
                    </div>
                  </div>
                </div>

                {/* Income Sources */}
                {incomeData.length > 0 && (
                  <div style={{ background: 'rgba(30, 41, 59, 0.5)', borderRadius: '20px', padding: '24px', border: '1px solid #334155', marginBottom: '32px' }}>
                    <h2 style={{ fontSize: '18px', fontWeight: 600, marginBottom: '24px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <div style={{ width: '20px', height: '20px', color: '#34d399' }}><Icons.TrendingUp /></div>
                      Income Sources
                    </h2>
                    <div style={{ height: '180px' }}>
                      <ResponsiveContainer width="100%" height="100%">
                        <BarChart data={incomeData} layout="vertical">
                          <CartesianGrid strokeDasharray="3 3" stroke="#334155" horizontal={false} />
                          <XAxis type="number" stroke="#64748b" fontSize={11} tickFormatter={(v) => `â‚¬${v}`} />
                          <YAxis type="category" dataKey="name" stroke="#64748b" fontSize={11} width={100} />
                          <Tooltip
                            content={({ active, payload }) => {
                              if (active && payload && payload.length) {
                                return (
                                  <div style={{ background: '#1e293b', border: '1px solid #334155', borderRadius: '8px', padding: '8px 12px' }}>
                                    <p style={{ fontWeight: 500 }}>{formatCurrency(payload[0].value)}</p>
                                  </div>
                                );
                              }
                              return null;
                            }}
                          />
                          <Bar dataKey="value" fill="#22c55e" radius={[0, 4, 4, 0]} />
                        </BarChart>
                      </ResponsiveContainer>
                    </div>
                  </div>
                )}

                {/* Category Breakdown */}
                <div style={{ background: 'rgba(30, 41, 59, 0.5)', borderRadius: '20px', padding: '24px', border: '1px solid #334155', marginBottom: '32px' }}>
                  <h2 style={{ fontSize: '18px', fontWeight: 600, marginBottom: '24px' }}>Category Breakdown</h2>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                    {pieData.map((cat) => {
                      const Icon = CATEGORY_ICONS[cat.name] || Icons.CreditCard;
                      const percentage = ((cat.value / totalExpenses) * 100).toFixed(1);
                      return (
                        <button
                          key={cat.name}
                          onClick={() => setSelectedCategory(selectedCategory === cat.name ? null : cat.name)}
                          style={{
                            width: '100%',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '16px',
                            padding: '12px',
                            borderRadius: '12px',
                            background: selectedCategory === cat.name ? '#334155' : 'rgba(51, 65, 85, 0.2)',
                            border: selectedCategory === cat.name ? '1px solid rgba(255,255,255,0.2)' : '1px solid transparent',
                            color: '#e2e8f0',
                            cursor: 'pointer',
                            textAlign: 'left'
                          }}
                        >
                          <div style={{ 
                            width: '44px', 
                            height: '44px', 
                            borderRadius: '12px', 
                            display: 'flex', 
                            alignItems: 'center', 
                            justifyContent: 'center',
                            background: `${CATEGORY_COLORS[cat.name]}20`,
                            flexShrink: 0
                          }}>
                            <div style={{ color: CATEGORY_COLORS[cat.name], width: '22px', height: '22px' }}><Icon /></div>
                          </div>
                          <div style={{ flex: 1, minWidth: 0 }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '6px' }}>
                              <span style={{ fontWeight: 500 }}>{cat.name}</span>
                              <span className="mono" style={{ color: '#94a3b8' }}>{formatCurrency(cat.value)}</span>
                            </div>
                            <div style={{ height: '6px', background: '#334155', borderRadius: '50px', overflow: 'hidden' }}>
                              <div style={{ 
                                height: '100%', 
                                borderRadius: '50px',
                                width: `${percentage}%`,
                                background: CATEGORY_COLORS[cat.name],
                                transition: 'width 0.5s ease'
                              }} />
                            </div>
                          </div>
                          <span style={{ fontSize: '14px', color: '#64748b', width: '50px', textAlign: 'right', flexShrink: 0 }}>{percentage}%</span>
                        </button>
                      );
                    })}
                  </div>
                </div>

                {/* Transactions List */}
                <div style={{ background: 'rgba(30, 41, 59, 0.5)', borderRadius: '20px', border: '1px solid #334155', overflow: 'hidden' }}>
                  <div style={{ padding: '20px 24px', borderBottom: '1px solid #334155', display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '12px' }}>
                    <h2 style={{ fontSize: '18px', fontWeight: 600, display: 'flex', alignItems: 'center', gap: '8px', margin: 0 }}>
                      <div style={{ width: '20px', height: '20px', color: '#64748b' }}><Icons.FileText /></div>
                      {selectedCategory ? `${selectedCategory} Transactions` : 'Recent Transactions'}
                      {selectedCategory && (
                        <button 
                          onClick={() => setSelectedCategory(null)}
                          style={{ 
                            marginLeft: '8px', 
                            fontSize: '12px', 
                            padding: '4px 10px', 
                            borderRadius: '50px', 
                            background: '#334155', 
                            color: '#cbd5e1', 
                            border: 'none',
                            cursor: 'pointer'
                          }}
                        >
                          Clear filter Ã—
                        </button>
                      )}
                    </h2>
                    <span style={{ fontSize: '14px', color: '#64748b' }}>{filteredTransactions.length} transactions</span>
                  </div>
                  
                  <div>
                    {displayedTransactions.map((t, idx) => {
                      const Icon = CATEGORY_ICONS[t.category] || Icons.CreditCard;
                      return (
                        <div 
                          key={t.id} 
                          style={{ 
                            padding: '16px 24px', 
                            display: 'flex', 
                            alignItems: 'center', 
                            gap: '16px',
                            borderBottom: idx < displayedTransactions.length - 1 ? '1px solid #1e293b' : 'none',
                            background: 'transparent',
                            transition: 'background 0.2s'
                          }}
                          onMouseEnter={(e) => e.currentTarget.style.background = 'rgba(51, 65, 85, 0.3)'}
                          onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                        >
                          <div style={{ 
                            width: '44px', 
                            height: '44px', 
                            borderRadius: '12px', 
                            display: 'flex', 
                            alignItems: 'center', 
                            justifyContent: 'center',
                            background: `${CATEGORY_COLORS[t.category]}20`,
                            flexShrink: 0
                          }}>
                            <div style={{ color: CATEGORY_COLORS[t.category], width: '22px', height: '22px' }}><Icon /></div>
                          </div>
                          <div style={{ flex: 1, minWidth: 0 }}>
                            <p style={{ fontWeight: 500, margin: 0, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{t.description}</p>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginTop: '4px', fontSize: '13px', color: '#64748b' }}>
                              <span>{t.date}</span>
                              <span>â€¢</span>
                              <span style={{ 
                                padding: '2px 8px', 
                                borderRadius: '50px', 
                                fontSize: '11px',
                                background: `${CATEGORY_COLORS[t.category]}20`,
                                color: CATEGORY_COLORS[t.category]
                              }}>
                                {t.category}
                              </span>
                            </div>
                          </div>
                          <div style={{ textAlign: 'right', flexShrink: 0 }}>
                            <p className="mono" style={{ fontWeight: 600, margin: 0, color: t.amount > 0 ? '#34d399' : '#e2e8f0' }}>
                              {t.amount > 0 ? '+' : ''}{formatCurrency(t.amount)}
                            </p>
                            <p style={{ fontSize: '12px', color: '#64748b', margin: '2px 0 0 0' }}>Bal: {formatCurrency(t.balance)}</p>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  
                  {filteredTransactions.length > 15 && (
                    <button
                      onClick={() => setShowAllTransactions(!showAllTransactions)}
                      style={{
                        width: '100%',
                        padding: '16px 24px',
                        textAlign: 'center',
                        fontSize: '14px',
                        color: '#94a3b8',
                        background: 'transparent',
                        border: 'none',
                        borderTop: '1px solid #1e293b',
                        cursor: 'pointer',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '8px'
                      }}
                      onMouseEnter={(e) => { e.currentTarget.style.background = 'rgba(51, 65, 85, 0.3)'; e.currentTarget.style.color = '#e2e8f0'; }}
                      onMouseLeave={(e) => { e.currentTarget.style.background = 'transparent'; e.currentTarget.style.color = '#94a3b8'; }}
                    >
                      {showAllTransactions ? (
                        <>Show less <div style={{ width: '16px', height: '16px' }}><Icons.ChevronUp /></div></>
                      ) : (
                        <>Show all {filteredTransactions.length} transactions <div style={{ width: '16px', height: '16px' }}><Icons.ChevronDown /></div></>
                      )}
                    </button>
                  )}
                </div>

                {/* Footer */}
                <footer style={{ marginTop: '48px', textAlign: 'center', fontSize: '14px', color: '#64748b', paddingBottom: '32px' }}>
                  <p>Bank Analyzer â€¢ Designed for NLB Slovenia Bank Statements</p>
                  <p style={{ marginTop: '4px' }}>Your data is stored locally in your browser</p>
                </footer>
              </>
            )}
          </main>
        </div>
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<BankAnalyzer />);
  </script>
</body>
</html>
